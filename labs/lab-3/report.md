# Лабораторная работа 3

1. Запустить программу с использованием OpenMP для различных наборов входных данных. Отметить ошибки в работе программы.
2. Запустить программу с отладчиком Intel Thread Checker. Составить
   список потенциально проблемных мест и ошибок при синхронизации нескольких потоков.
3. Устранить ошибки в программе.
4. Вновь запустить Intel Thread Checker и убедиться в правильности работы программы.

## Исходный код

```c++
#include <stdio.h>
#include <math.h>
#include <omp.h>
#define N 1000

int main(int argc, char **argv) {
  double x[N], y[N];
  x[0] = 0;
# pragma omp parallel for nowait
  for (i = 1; i < N; i++) {
    x[i] = x[i - 1] * x[i - 1];
    y[i] = x[i] / y[i - 1];
  }
  y[0] = x[N - 1];
  return 0;
}
```

## Ошибки

### Присваивание необъявленной переменной

Ошибка в строке 10:

```c++
...
  for (i = 1; i < N; i++) {
...
```

Следует объявить переменную `i` перед присваиванием:

```c++
...
  for (int i = 1; i < N; i++) {
...
```

### Некорректная OpenMP директива

Использование конструкции `nowait`, убирающая барьерную синхронизацию в конце потоков, не может быть объявлена следующим
образом:

```c++
...
# pragma omp parallel for nowait
...
```

Также не указаны разделяемые ресурсы. Вместо этого следует сделать следующим образом:

```c++
...
# pragma omp parallel shared(x, y)
  {
# pragma omp for nowait
  for ...
  }
...
```

### Массивы нулей

Несложно заметить, что массив `x` в конечном итоге будут состоять из 0:

```c++
...
  x[0] = 0;
  # pragma omp parallel for nowait
    for (int i = 1; i < N; i++) {
      x[i] = x[i - 1] * x[i - 1];
      y[i] = x[i] / y[i - 1];
    }
  y[0] = x[N - 1];
...
```

Можно убрать ненужные операцию умножения и вызов других элементов массивов:

```c++
...
  x[0] = 0;
  # pragma omp parallel for nowait
    for (int i = 1; i < N; i++) {
      x[i] = 0;
      y[i] = 0 / y[i - 1];
    }
  y[0] = x[N - 1];
...
```

### Деление на нуль

Честно говоря, непонятно, было ли так задумано, но начиная с `i` равное 2, происходит деление
на нуль

```c++
...
    y[i] = 0 / y[i - 1];
...
```

Неизвестно, было ли так задумано или нет, требуется уточнение у преподавателя.
